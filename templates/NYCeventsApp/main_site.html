{% extends 'base.html' %}

{% block title %} Home {% endblock %}

{% block content %}
    {% if response %}
        <div id="map"></div>
    {% endif %}

    <div id="reg-form" class="container">
        <div id="form-title" class="jumbotron jumbotron">
                              <div class="container">
                                  <h1 class="lead">Welcome to NYC TaxVent!</h1>
                              </div>
        </div>

    <div class="form-group">
        <div id="form-title" class="jumbotron jumbotron">
            <div class="container">
                <h2 class="lead">Select event</h2>
            </div>
        </div>
        <form method="POST" class="post-form"> {% csrf_token %}
            <div class="form-row">
                    <div class="col-lg-12">
                        <div class="input-group">
                            {{ form.choose_event }}
                            <span class="input-group-btn">
                            <button class="btn btn-secondary" type="submit">Search!</button>
                          </span>
                        </div>
                      </div>
            </div>
            <div class="form-check">
                    <label class="form-check-label">
                      <input type="checkbox" name="switch_direction" class="form-check-input">
                      Switch direction
                    </label>
            </div>

        </form>
    </div>

    </div>
    <script>

var map, heatmap, marker;
var myLatLng = {lat: {{ latitude }}, lng: {{ longitude }}};
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: {lat: {{ latitude }}, lng: {{ longitude }}},
    mapTypeId: 'satellite'
  });

  heatmap = new google.maps.visualization.HeatmapLayer({
    data: getPoints(),
    map: map,
  });

  marker = new google.maps.Marker({
    position: myLatLng,
    map: map,
    title: 'Event location',
    animation: google.maps.Animation.DROP,
  });
}

function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

function changeGradient() {
  var gradient = [
    'rgba(0, 255, 255, 0)',
    'rgba(0, 255, 255, 1)',
    'rgba(0, 191, 255, 1)',
    'rgba(0, 127, 255, 1)',
    'rgba(0, 63, 255, 1)',
    'rgba(0, 0, 255, 1)',
    'rgba(0, 0, 223, 1)',
    'rgba(0, 0, 191, 1)',
    'rgba(0, 0, 159, 1)',
    'rgba(0, 0, 127, 1)',
    'rgba(63, 0, 91, 1)',
    'rgba(127, 0, 63, 1)',
    'rgba(191, 0, 31, 1)',
    'rgba(255, 0, 0, 1)'
  ]
  heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
}

function changeRadius() {
  heatmap.set('radius', heatmap.get('radius') ? null : 20);
}

function changeOpacity() {
  heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
}

// Heatmap data: 500 Points
function getPoints() {
    var list = []
    {% for row in response %}
        list.push(new google.maps.LatLng({{ row.0 }}, {{ row.1 }}));
    {% endfor %}
    return list;
}

    </script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqZXQrRSkucJiWKx7eadH7qfv29uUFXno&libraries=visualization&callback=initMap">
    </script>

    <script>
    $( document ).ready(function() {
        if ( $('#map').length ){
            $("#reg-form").css("margin-top","20px");
        }
        else{
            $("#reg-form").css("margin-top","20vh");
        }
    });
    </script>

{% endblock %}